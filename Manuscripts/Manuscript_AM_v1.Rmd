---
title: '**Bayesian statistics for longitudinal studies in biomedical research**'
author: 
- Ariel Mundo^[Department of Biomedical Engineering, University of Arkansas, Fayetteville]
- Timothy J. Muldoon^[Department of Biomedical Engineering, University of Arkansas, Fayetteville]
- John R. Tipton^[Department of Mathematical Sciences, University of Arkansas, Fayetteville]
  
bibliography: refs.bib
output:
  html_document: default
  pdf_document: 
    fig_caption: yes
  css: style.css
  word_document:
    reference_docx: docx_template.docx
mainfont: Times New Roman
link-citations: yes
subtitle: '_Their application and use in biomedical research_'
biblio-style: apalike
---



## Paper outline
<span style="color: red;">\textcolor{red}{The paper Introduction has been updated, proposed sections appear at the end of the document as well as an initial graph.}</span>


## Background

A longitudinal study is defined as one where a variable of interest is measured repeatedly in a group (or groups) of subjects. In biomedical research, this type of study is preferred when the intention is to observe the evolution of the effect of treatment across time, rather than analyzing the information at a single timepoint (a cross-sectional study). Clinical examples of this  approach in biomedical research include studies on breast and neck cancer[@sio2016;@kamstra2015]; in the first case, weekly measurements of skin toxicities in  patients with radiation-induced dermatitis were taken for up to 8 weeks; whereas in the latter mouth opening measured was assessed at 6,12, 18, 24 and 36 months after radiotherapy (RT). Longitudinal studies have used also to measure tumor response [@roblyer2011;@tank2020;@pavlov2018;@demidov2018], antibody expression[@ritter2001;@roth2017], and cell metabolism[@jones2018;@skala2010]. From a statistical standpoint, a longitudinal study presents advantages over a cross-sectional approach:it requires a lower number of subjects to reach a certain statistical power, and besides it being able to track the previously mentioned time-effect evolution on a group-by-group basis, it allows to determine the variability of the response within subjects [@guo2013; @fitzmaurice2012]. In other words,a longitudinal study permits to quantify how the variable changes within each subject across time.

Researchers have typically employed a _frequentist_ approach to analyze longitudinal data, a statistical view that derives its name from the fact that it regards probability as a limiting frequency [wagenmakers2008]. when applied to longitudinal, a frequentist analysis is  based on a null hypothesis test using the _analysis of variance over repeated measures_ (repeated measures ANOVA or rm-ANOVA). This methodology makes two key assumptions regarding longitudinal data: a constant correlation across same-subject measurements and  complete observations from each subject [@schober2018;@gueorguieva2004]. The first condition is frequently unjustified  as  the correlation between measures diminishes when the time gap between them increases [@ugrinowitsch2004], and in that case violating that assumption increases the type I error rate[@lane2016]. The reasons behind the second assumption being not met in biomedical research are varied: subjects can withdraw during the course of the study, attrition in animals due to injury or weight loss, or complications can arise that prevent the researcher from collecting measurements at a certain timepoint. When these issues arise, rm-ANOVA requires to exclude the subject with missing observations from the analysis, which can lead to increased costs for the study if the desired statistical power is not met with the remaining subjects, and can lead to the exclusion of valuable information.Additionaly, rm-ANOVA uses a _post hoc_ analysis to assess significance in the differences between groups. Because a _post hoc_ analysis is based in multiple repeated comparisons, it can inflate the false positivity rate[@liu2010]. 

Recently, _linear mixed effects models_ (LMEMs) have been used by certain groups to analyze biomedical longitudinal data [@vishwanath2009;@skala2010]. Briefly, these models incorporate _fixed_ effects, which correspond to the levels of experimental factors in the study (e.g. the different drug regimens in a clinical trial), and _random_ effects, which account for random variation within the population [@pinheiro2006]. These models are more flexible than rm-ANOVA as they can accommodate missing observations in the data, and  allow different modeling strategies for the covariance[@west2014]. On the other hand, they impose restrictions in the distribution of the errors and of the random effects, and assume linearity between the response and the parameters[@schielzeth2020;@pinheiro2006]. 

The assumption of linearity is a key component of LMEMs and rm-ANOVA, and therefore both models restrict the inferences they can extract from longitudinal data when it does not follow a linear trend. In biomedical research, such behavior in longitudinal data does arise and has been exemplified in different studies, including response to radio/chemotherapy in preclinical and clinical settings  [@vishwanath2009; @roblyer2011;@tank2020;@skala2010;@demidov2018], and wound healing and metabolism[@jones2018;@grice2010;@young1994]. In such situations, an estimated model via rm-ANOVA or LMEMs may not provide a consistent fit with the observed variations in the variables of interest. Moreover, although it is possible to obtain a "significant" _p-value_( _p_<0.05) due to the well-known variability of this metric [@nuzzo2014;@halsey2019], the model will lack predictive power and this in turn will compromise the extent of the inferences that can be derived from it.

Since both the _frequentist_ (rm-ANOVA) and LMEM approaches are limited in the analysis of non-linear longitudinal information, there is a need for biomedical researchers to use statistical tools that allow the data to determine the fit of the model while enabling  inferences that are  both adequate and consistent from a statistical standpoint.

Generalized additive models (GAMs) are a subset of generalized linear models that use _smooth functions_ (hencefort _smooths_) to estimate the parameters of a model. They have been used in palaeolimnology, ecology and clinical studies to model longitudinal data[@woolway2016;@hefley2017;@ko2007]. Briefly, GAMs use a combination of multiple functions (basis functions)to construct the smooths of the model [@wood2017]. Their main advantage over LMEMs and rm-ANOVA is that the model specification is directed by the _smooths_ rather than by a parametric relationship. This allows a consistent fit of the model with the data, and estimations of significance using the terms of the model. However, certain assumptions about the data are necessary: a normal distribution and constant variance of the residuals with the mean response. Therefore, GAMs provide a more suitable statistical method to analyze biomedical longitudinal data, when these assumptions of the model are met by the data.


However, it is possible that the assumptions of GAMs for longitudinal data do not hold under  certain circumstances. In that case, the field of _Bayesian statistics_ represents a relatively new area of Statistics that does not rely on _p-values_ and hypothesis tests to analyze information. Bayesian statistics can work with missing observations, allow the data (and not an underlying assumed distribution) to determine the outcome in regard to significance and are able to expand the number of comparisons and inferences derived form the analysis. On the other hand, the shift that Bayesian statistics represent from the traditional _frequentist_ statistical view in research, the computational tools required for its implementation, and the underlying mathematical theory have limited the use of this approach in the biomedical research community. However,Bayesian theory is intuitive and shares some principles with _frequentist_ statistics, and there is an increasing use and recognition of the advantages of their use across different areas of biomedical research such as clinical trial design and imaging[@biswas2009;@kelter2020;@kwon2020;@zhou2017]. Additionally,the current development in computational tools, specifically the programming language $\textsf{R}$, enable a rapid implementation of Bayesian models for longitudinal data.

Therefore, this study focuses in three areas in the analysis of longitudinal data from a biomedical perspective. First, it presents the limitations of (rm-ANOVA) and LMEMs over longitudinal data, and explains how these limitations in turn affect the results of the analysis. Secondly, it uses simulation to generate non-linear longitudinal data and presents the implementation of GAMs as a statistical tool that enables the analysis of data that shows this behavior. And finally, it introduces Bayesian statistics and presents their implementation with GAMs over simulated data to demonstrate the differences and benefits of this approach . With an emphasis on reproducibility by providing the code and dataset used, this study provides biomedical researchers with a clear view of the advantages of different approaches in the statistical analysis of longitudinal data.

- Why LMEMs are better than ANOVA

- How LMEMs (using splines) and a Bayesian analysis can be used to analyze longitudinal data


https://www.frontiersin.org/articles/10.3389/fevo.2018.00149/full

```{r,FIGURE 1,echo=FALSE, message=FALSE, warning=FALSE, fig.cap='Simulated longitudinal data with a linear trend.'}
rm(list=ls())
set.seed(123)
library(ggplot2)
library(splines)
library(tidyverse)
library(here)


linear<-read.csv(here("data","Simulated_linear.csv"))

sim_linear <- function(dat, n = 10, sd = 5) {
    linear_vals <- dat %>%
        slice(rep(1:n(), each = n)) %>%
        group_by(Group,Day) %>%
        mutate(observation = rnorm(n, y, sd)) %>%
        ungroup()

    return(linear_vals)
}
n<-10
sd<-2
linear_vals <- sim_linear(linear, n, sd)
linear_vals[] <- lapply(linear_vals, function(observation) ifelse(observation<=0, NA, observation)) #taking out values below 0

 ggplot(linear_vals, aes(x = Day, y = observation, color = Group)) +
    geom_point() +
    ggtitle("Simulated linear time-varying responses") +
    scale_color_viridis_d(end = 0.75) +
    geom_line(aes(y = y), alpha = 0.75) +
    theme_bw()

```

## Section 1: 

### Challenges presented by longitudinal studies: 

### 1 The _frequentist_ case for longitudinal data

While the _repeated measures analysis of variance_ (rm-ANOVA) is the standard for the statistical analysis of longitudinal data, there are key assumptions that are made in order to make the model valid. From a practical view, they can be divided in three areas: linear relationship between covariates and response, constant correlation between measurements, and complete observations for all subjects. Each one of these assumptions is discussed below.
  
#### 1.1 Linear relationship 

In a biomedical longitudinal study, two or more groups of subjects (humans, mice, samples) are subject to a different treatments (e.g. group of mice receiving a novel drug vs. a group that receives a placebo), and measurements from each subject within each group are collected at specific time points. Moreover, it is assumed that the collected response has two components: a _fixed_ and a _random_ component. The _fixed_ component can be understood as a constant value in the response which the researcher intends to measure, i.e, the effect of a novel drug in a subject.The _random_ component can be defined as "noise" caused by some some factors that are not of interest to the researcher, i.e., if the concentration of a drug is measured in some subjects within the same group in the early hours of the morning while others are measured in the afternoon, the researcher might consider this variability in the collection time of the measurement to introduce some "noise" in the signal. As their name suggests, this "random" variabliity needs to be modeled as a variable rather than as a constant value.


Mathematically speaking, if a normally distributed response $y$ is measured repeatedly at $t$ time points from subjects in $p$ groups, where each group has a certain $n_p$ number of subjects, the the model for the response $y_{hij}$ becomes:

$$ y_{hij}=\mu+\gamma_h+\tau_j+(\gamma \tau)_{hj}+\pi_{i(h)}+e_{hij}$$
Where 

$i=1,...,n_h$ $j=1,...,t$, $h=1,...,p$; with $\pi_i{h} \sim N(0,\sigma^{2}_\epsilon)$ (independently normally distributed) and $e_{hij} \sim N(0,\sigma^{2}_\epsilon)$

In this model, $\mu$ represents the group mean, $\gamma_h$ is the _fixed effect_ of group $h$, $\tau_j$ is the fixed effect of time $j$, and $(\gamma \tau)_{hj}$ represents the interaction of time and group effects. The term $\pi_{ij}$ represents the _random effects_ for each subject within each group.Finally, $e_{hij}$ represents the independent random error terms, which need to be normally distributed with mean 0 [@davis2002]. The model then, is a linear combination of terms, and if plotted, it would a straight line.

#### 1.2 Constant correlation 


Missing observations, and correlation between measurements. How rm-ANOVA is limited by missing observations, and how both rm-ANOVA and LMEMs are limited with data that does not follow a linear trend (equations for both situations and the fit they produce.)
#### 1.1 Constant correlation

While the _repeated measures analysis of variance_ (rm-ANOVA) is the norm in the biomedical community to analyze longitudinal data, two frequent situations that arise in longitudinal studies limit its applicability. 
Missing observations, and correlation between measurements. How rm-ANOVA is limited by missing observations, and how both rm-ANOVA and LMEMs are limited with data that does not follow a linear trend (equations for both situations and the fit they produce.)

One of the key assumptions for rm-ANOVA is the constant correlation among measurements. This frequently not the case as the correlation reduces as the time interval between two measurements increases [@ugrinowitsch2004]. From a practical  

#### 1.2 the case of LMEMs using splines and how they work and how they are better than rm-ANOVA



#### 1.3 Bayesian brief introduction, and compare the results of 1.2 to the results of Bayesian


* Section 2: Implementation of both LMEMs and Bayesian and their results


Present the implementation of a spline-fitted model in R, using data simulated from [@vishwanath2009]

***



# References
